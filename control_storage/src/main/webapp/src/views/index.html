<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Class</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../layuiadmin/style/admin.css" media="all">
    <script src="/static/js/jquery-3.4.1.min.js"></script>
    <script src="/static/js/jquery.base64.js"></script>

</head>

<body class="layui-layout-body">

    <div id="LAY_app">
        <div class="layui-layout layui-layout-admin">
            <div class="layui-header">
                <!-- 头部区域 -->
                <ul class="layui-nav layui-layout-left">
                    <li class="layui-nav-item layadmin-flexible" lay-unselect>
                        <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
                            <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-hide-xs" lay-unselect>
                        <a href="http://www.kgc.cn" target="_blank" title="课工场">
                            <i class="layui-icon layui-icon-website"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item" lay-unselect>
                        <a href="javascript:;" layadmin-event="refresh" title="刷新">
                            <i class="layui-icon layui-icon-refresh-3"></i>
                        </a>
                    </li>

                </ul>
                <ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">
                    <!-- <li class="layui-nav-item" lay-unselect>
            <a lay-href="/money.html" lay-text="交班费">
              <i class="layui-icon layui-icon-rmb"></i>
            </a>
          </li> -->
                    <!-- <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="/money.html" title="交班费" id="jiaobanfei">
              <i class="layui-icon layui-icon-rmb"></i>
            </a>
          </li> -->
                    <li class="layui-nav-item" lay-unselect>
                        <a lay-href="/CheckIn.html" lay-text="签到">
                            <i class="layui-icon layui-icon-ok"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item" lay-unselect>
                        <a lay-href="/addFace.html" lay-text="人脸认证">
                            <i class="layui-icon layui-icon-camera"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-hide-xs" lay-unselect>
                        <a href="javascript:;" layadmin-event="theme">
                            <i class="layui-icon layui-icon-theme"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-hide-xs" lay-unselect>
                        <a href="javascript:;" layadmin-event="note">
                            <i class="layui-icon layui-icon-note"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-hide-xs" lay-unselect>
                        <a href="javascript:;" layadmin-event="fullscreen">
                            <i class="layui-icon layui-icon-screen-full"></i>
                        </a>
                    </li>
                    <li class="layui-nav-item" lay-unselect>
                        <a href="javascript:;">
                            <img id="src" src="http://pztjs4mye.bkt.clouddn.com/微信图片_20191024005853.jpg" class="layui-nav-img">
                            <cite id="username"></cite>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a lay-href="set/user/info.html">基本资料</a></dd>
                            <dd><a lay-href="set/user/password.html">修改密码</a></dd>
                            <hr>
                            <dd style="text-align: center;cursor:pointer"><a id="out">退出</a></dd>
                        </dl>
                    </li>

                    <li class="layui-nav-item layui-hide-xs" lay-unselect>
                        <a href="javascript:;" layadmin-event="about"><i class="layui-icon layui-icon-more-vertical"></i></a>
                    </li>
                    <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-unselect>
                        <a href="javascript:;" layadmin-event="more"><i class="layui-icon layui-icon-more-vertical"></i></a>
                    </li>
                </ul>
            </div>

            <!-- 侧边菜单 -->
            <div class="layui-side layui-side-menu">
                <div class="layui-side-scroll">
                    <div class="layui-logo">
                        <span>ClassManager</span>
                    </div>

                    <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu" lay-filter="layadmin-system-side-menu">

                        <li data-name="home" class="layui-nav-item layui-nav-itemed">
                            <a href="javascript:;" lay-tips="主页" lay-direction="2">
                                <i class="layui-icon layui-icon-home"></i>
                                <cite>主页</cite>
                            </a>
                            <dl class="layui-nav-child">
                                <dd data-name="console" class="layui-this">
                                    <a lay-href="" id="kongzhitai">控制台</a>
                                </dd>
                                <dd data-name="console">
                                    <a lay-href="" id="zhuye">主页</a>
                                </dd>
                            </dl>
                        </li>


                        <li data-name="app" class="layui-nav-item">
                            <a href="javascript:;" lay-tips="应用" lay-direction="2">
                                <i class="layui-icon layui-icon-app"></i>
                                <cite>应用</cite>
                            </a>
                            <dl class="layui-nav-child">

                                <dd data-name="forum" id="daibanshixiang">
                                    <a href="javascript:;">待办事项</a>
                                    <dl class="layui-nav-child">
                                        <dd data-name="list"><a lay-href="app/forum/list.html" id="zhanghaoshenpi">账号审批</a></dd>
                                        <dd data-name="replys"><a lay-href="app/forum/replys.html" id="qingjiashenpi">请假审批</a></dd>
                                        <dd data-name="daiding"><a lay-href="app/forum/daiding.html" id="daiding">待定</a></dd>
                                    </dl>
                                </dd>

                                <!-- <dd data-name="">
                  <a lay-href="/scoreAdd.html" id="chengjiluru">成绩录入</a>
                </dd> -->
                                <dd data-name="">
                                    <a lay-href="/ordealTest.html" id="kaotiguanli">考题管理</a>
                                </dd>
                                <dd data-name="">
                                    <a lay-href="user/user/phoneMessage.html" id="tongzhi">通知</a>
                                </dd>
                                <dd data-name="">
                                    <a lay-href="/money.html" id="jiaobanfei">交班费</a>
                                </dd>
                                <dd data-name="">
                                    <a lay-href="/record.html" id="record">缴费记录</a>
                                </dd>
                                <dd data-name="">
                                    <a lay-href="/test.html" id="rice">日测</a>
                                </dd>
                                <dd data-name="">
                                    <a lay-href="/tiwen.html" id="tiwen">随机提问</a>
                                </dd>
                            </dl>
                        </li>

                        <li data-name="user" class="layui-nav-item" id="yonghu">
                            <a href="javascript:;" lay-tips="用户" lay-direction="2">
                                <i class="layui-icon layui-icon-user"></i>
                                <cite>用户</cite>
                            </a>
                            <dl class="layui-nav-child">
                                <dd>
                                    <a lay-href="user/user/list.html" id="wangzhanyonghu">网站用户</a>
                                </dd>

                            </dl>
                        </li>

                        <li data-name="set" class="layui-nav-item" id="shezhi">
                            <a href="javascript:;" lay-tips="设置" lay-direction="2">
                                <i class="layui-icon layui-icon-set"></i>
                                <cite>设置</cite>
                            </a>
                            <dl class="layui-nav-child">

                                <dd class="layui-nav-itemed">
                                    <a href="javascript:;">我的设置</a>
                                    <dl class="layui-nav-child">
                                        <dd><a lay-href="set/user/info.html">基本资料</a></dd>
                                        <dd><a lay-href="set/user/password.html">修改密码</a></dd>
                                    </dl>
                                </dd>
                            </dl>
                        </li>

                    </ul>
                </div>
            </div>

            <!-- 页面标签 -->
            <div class="layadmin-pagetabs" id="LAY_app_tabs">
                <div class="layui-icon layadmin-tabs-control layui-icon-prev" layadmin-event="leftPage"></div>
                <div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
                <div class="layui-icon layadmin-tabs-control layui-icon-down">
                    <ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
                        <li class="layui-nav-item" lay-unselect>
                            <a href="javascript:;"></a>
                            <dl class="layui-nav-child layui-anim-fadein">
                                <dd layadmin-event="closeThisTabs"><a href="javascript:;">关闭当前标签页</a></dd>
                                <dd layadmin-event="closeOtherTabs"><a href="javascript:;">关闭其它标签页</a></dd>
                                <dd layadmin-event="closeAllTabs"><a href="javascript:;">关闭全部标签页</a></dd>
                            </dl>
                        </li>
                    </ul>
                </div>
                <div class="layui-tab" lay-unauto lay-allowClose="true" lay-filter="layadmin-layout-tabs">
                    <ul class="layui-tab-title" id="LAY_app_tabsheader">
                        <!-- 主页logo小按钮********************************************************************************************************* -->
                        <!-- id是指向的界面连接 -->
                        <li class="layui-this" id="fangzi"><i class="layui-icon layui-icon-home"></i></li>
                    </ul>
                </div>
            </div>


            <!-- 主体内容 -->
            <div class="layui-body" id="LAY_app_body">
                <div class="layadmin-tabsbody-item layui-show">
                    <!-- 主页显示的内容*********************************************************************************************************** -->
                    <iframe src="" frameborder="0" class="layadmin-iframe" id="zhuyexianshineirong"></iframe>
                </div>
            </div>

            <!-- 辅助元素，一般用于移动设备下遮罩 -->
            <div class="layadmin-body-shade" layadmin-event="shade"></div>
        </div>
    </div>

    <script src="../layuiadmin/layui/layui.js"></script>
    <script>
        $(() => {
            layui.config({
                base: '../layuiadmin/' //静态资源所在路径
            }).extend({
                index: 'lib/index' //主入口模块
            }).use(['index', 'form']);

            layui.use('form', function() {
                var $ = layui.$
                layer = layui.layer

                let user = sessionStorage.getItem("user")
                let $user = JSON.parse(user);
                let $url = JSON.parse(sessionStorage.getItem('url'))

                var args = new Object();
                args = GetUrlParms();
                if (user == null && args["d"] == undefined) {

                    loginOut()
                } else {
                    //如果要查找参数key:
                    if (args["d"] != undefined) {
                        //如果要查找参数key:
                        var value1 = args["d"];
                        console.log(value1) //Base64加密的json串
                        let decoder = $.base64.decode(value1)
                        console.log(decoder) //解密的 json串 

                        let $res = JSON.parse(decoder)
                        let $uuid = sessionStorage.getItem('uuid')

                        if ($user.uuid == $uuid) {
                            $.ajax({
                                url: $url + "/front/record.action?methodName=insertRecord",
                                type: 'post',
                                dataType: 'json',
                                data: {
                                    'uuid': $uuid,
                                    'time': $res.time,
                                    'out_trade_no': $res.out_trade_no,
                                    'trade_no': $res.trade_no,
                                    'total_amount': $res.total_amount
                                },
                                success: (re) => {
                                    switch (re.status) {
                                        case "success":
                                            sessionStorage.removeItem('uuid')
                                            location.replace('/src/views/index.html')
                                            break;
                                        case "failed":
                                            layer.msg('缴费失败')
                                            break;

                                        default:
                                            break;
                                    }
                                }
                            })


                        }
                    }
                }


                $('#out').click(() => {
                    location.replace('/login.html')
                })



                $.ajax({
                    url: $url + "/front/userInfo.action?methodName=queryUserInfoByUUID",
                    type: 'post',
                    dataType: 'json',
                    data: {
                        'uuid': $user.uuid
                    },
                    success: function(rs) {
                        switch (rs.status) {
                            case "success":
                                $('#src').attr("src", rs.data.headUrl)
                                document.getElementById('username').innerText = rs.data.nickname
                                break;
                            case "failed":
                                document.getElementById('username').innerText = JSON.parse(user).account
                                break;
                            default:
                                break;
                        }
                    },
                    error: function() {
                        layer.msg("服务器走丢了");
                    }
                })



                setInterval(() => {
                    if (sessionStorage.getItem('code') == 0) {
                        $.ajax({
                            url: $url + "/front/userInfo.action?methodName=queryUserInfoByUUID",
                            type: 'post',
                            dataType: 'json',
                            data: {
                                'uuid': $user.uuid
                            },
                            success: function(rs) {
                                switch (rs.status) {
                                    case "success":
                                        $('#src').attr("src", rs.data.headUrl)
                                        document.getElementById('username').innerText = rs.data.nickname
                                        sessionStorage.removeItem('code')
                                        break;
                                    case "failed":

                                        break;
                                    default:
                                        break;
                                }
                            },
                            error: function() {
                                layer.msg("服务器走丢了");
                            }
                        })
                    }
                }, 1000 * 2);






                // if(value1!=""){
                //   let decoder = $.base64.decode(value1)
                //   console.log(decoder)
                //   console.log(value1)
                // }
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //   if($user.powrid==2){

                //   //根据角色修改连接
                //   $('#kongzhitai').attr('lay-href','home/homepage2.html')
                //   //根据角色修改title
                //   $('#kongzhitai').text('主页一')
                // }wangzhanyonghu   jiaobanfei  
                $("#daiding").css("display", "none");
                $("#tongzhi").css("display", "none");
                $("#tiwen").css("display", "none");
                $("#rice").css("display", "none");
                $("#record").css("display", "none");
                $("#jiaobanfei").css("display", "none");
                $("#qingjiashenpi").css("display", "none");
                $("#wangzhanyonghu").css("display", "none");
                $("#zhanghaoshenpi").css("display", "none"); //默认隐藏账号审批的操作
                $("#yonghu").css("display", "none"); //默认隐藏用户的操作
                $("#zhuye").css("display", "none"); //默认隐藏主页有url 和title
                $("#kongzhitai").css("display", "none"); //默认隐藏控制台有url 和title
                $("#daibanshixiang").css("display", "none"); //默认隐藏待办事项操作
                // $("#chengjiluru").css("display", "none");//默认隐藏成绩录入有url 和title
                $("#kaotiguanli").css("display", "none"); //默认隐藏考题管理有url 和title
                $("#zhuyexianshineirong").css("display", "none");
                // $("#zhuye").css("display", "").text($user.account)

                $.ajax({
                    url: $url + "/front/menu.action?methodName=showMenu",
                    type: 'post',
                    dataType: 'json',
                    data: {
                        'uuid': $user.uuid
                    },
                    success: (rs) => {
                        switch (rs.status) {
                            case "success":
                                var arr = rs.data
                                console.log(arr)
                                for (let index = 0; index < arr.length; index++) {
                                    console.log(arr[index].title)
                                    if (arr[index].uRL == "null") {
                                        $(arr[index].id).css("display", "");
                                    } else {
                                        $(arr[index].id).css("display", "");
                                        $(arr[index].id).attr('lay-href', arr[index].uRL)
                                        $(arr[index].id).text(arr[index].title)
                                    }
                                }
                                break;
                            case "failed":

                                break;

                            default:
                                break;
                        }
                    },
                    error: () => {

                    }
                })
                $.ajax({
                    url: $url + "/front/homePage.action?methodName=showHomePage",
                    type: 'post',
                    dataType: 'json',
                    data: {
                        'uuid': $user.uuid
                    },
                    success: (rs) => {
                        switch (rs.status) {
                            case "success":
                                $(rs.data.id).css("display", "");
                                console.log(rs.data.id)
                                console.log(rs.data.src)
                                $(rs.data.id).attr('src', rs.data.src)
                                $("#fangzi").attr('lay-id', rs.data.src)
                                $("#fangzi").attr('lay-attr', rs.data.src)
                                break;

                            default:
                                break;
                        }
                    },
                    error: () => {

                    }
                })
            })
        })


        function loginOut() {
            location.replace('/login.html')
        }

        function GetUrlParms() {
            var args = new Object();
            var query = location.search.substring(1); //获取查询串   
            var pairs = query.split("&"); //在逗号处断开   
            for (var i = 0; i < pairs.length; i++) {
                var pos = pairs[i].indexOf('='); //查找name=value   
                if (pos == -1) continue; //如果没有找到就跳过   
                var argname = pairs[i].substring(0, pos); //提取name   
                var value = pairs[i].substring(pos + 1); //提取value   
                args[argname] = unescape(value); //存为属性   
            }
            return args;
        }
    </script>


    <!-- 百度统计 -->
    <!-- <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?d214947968792b839fd669a4decaaffc";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script> -->
</body>

</html>